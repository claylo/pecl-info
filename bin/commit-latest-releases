#!/usr/bin/env bash

REPODIR="$(dirname "$(cd "$(dirname "$0")" && pwd -P)")"
PATH="${REPODIR}/bin:${PATH}"

if [[ -f "commit.txt" ]]; then
  rightnow=$(date '+%F_+%R')
  git pull --rebase
  git config push.autoSetupRemote true
  git stash
  git checkout -b "releases-${rightnow}"
  git stash pop
  generate-readme
  git add rest .etags data README.md
  git commit -F commit.txt
  git push
  gh pr create --fill --base main
  rm commit.txt
fi
